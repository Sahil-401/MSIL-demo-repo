pipeline {
  agent any

  environment {
    KUBE_CTX = "context-oke-amaaaaaaksfnvmaahftwc5deha4gq3zu"
  }

  stages {

    stage('Approval') {
      steps {
        input message: 'Approve PROD rollback?'
      }
    }

    stage('Rollback') {
      steps {
        sh """
          kubectl --context ${KUBE_CTX} rollout undo deployment/msil-demo -n prod
        """
      }
    }

    stage('Verify') {
      steps {
        sh """
          kubectl --context ${KUBE_CTX} rollout status deployment/msil-demo -n prod
        """
      }
    }
  }
}
